<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>06-lab</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <style>
    html {
      color: #373D49;
      line-height: 1.5rem;
    }
    body {
      max-width: 900px;
      margin: 0 auto;
      font-size: 1.25em;
    }
    h1, h2, h3 {
      font-family: "Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;
      font-size: 1.75rem;
      line-height: 2.25rem;
    }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; }
    code {
      color: #c7254e;
      padding: 2px 4px;
      border-radius: 4px;
    }
    .sourceCode pre {
      background: #f9f2f4;
    }
    a:hover {
      color: #7800e9;
    }
    li {
      margin-top: .5rem;
    }
  </style>
</head>
<body>
<h1 id="step-by-step-guide-to-shopping-list-example">Step by step guide to shopping list example</h1>
<h2 id="build-a-list">Build a list</h2>
<p>First we will get a very basic list working so we can add items to our list using javascript code.</p>
<p>We start with a blank template and add a simple header and a single <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul" title="The unordered list element - MDN">unordered list element</a> (use an ordered list if you want numbering). This list element will become our shopping list. The list is given the id <code>shopping</code> so we can select it by id.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="kw">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="kw">&lt;title&gt;</span>Shopping list<span class="kw">&lt;/title&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;css/styles.css&quot;</span><span class="kw">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">&lt;/head&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="kw">&lt;header&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="kw">&lt;h1&gt;</span>Shopping list<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="kw">&lt;/header&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="kw">&lt;ul</span><span class="ot"> id=</span><span class="st">&quot;shopping&quot;</span><span class="kw">&gt;&lt;/ul&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/shopping.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<h2 id="adding-items">Adding items</h2>
<p>Now in the linked file <code>js/shopping.js</code> we can get a handle to the list and write a simple function to add items to the list.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">const</span> listElement <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;shopping&#39;</span>)<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">function</span> <span class="at">addItem</span>(item) <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="kw">const</span> itemElement <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;li&#39;</span>)<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="va">itemElement</span>.<span class="at">textContent</span> <span class="op">=</span> item<span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="va">listElement</span>.<span class="at">appendChild</span>(itemElement)<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="op">};</span></span></code></pre></div>
<p>The function uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement" title="document.CreateElement - MDN"><code>document.createElement</code></a> to create an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/li" title="The list item element - MDN"><code>li</code></a> element. It places text in the element using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent" title="node.textContent - MDN"><code>node.textContent</code></a> and finally inserts our new element into the DOM using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild" title="node.appendChild - MDN"><code>node.appendChild</code></a>.</p>
<p>We can now add items by calling our function. Try this in the console.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="at">addItem</span>(<span class="st">&#39;rice&#39;</span>)<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="at">addItem</span>(<span class="st">&#39;pasta&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>We can also add multiple items from an array using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" title="Array.prototype.forEach - MDN"><code>Array.prototype.forEach</code></a>. This is a method available on all arrays, it takes a callback function as an argument. Each item of the array is passed in turn as an argument into the callback function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">const</span> list <span class="op">=</span> [<span class="st">&#39;rice&#39;</span><span class="op">,</span> <span class="st">&#39;pasta&#39;</span><span class="op">,</span> <span class="st">&#39;tea&#39;</span><span class="op">,</span> <span class="st">&#39;coffee&#39;</span>]<span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="va">list</span>.<span class="at">forEach</span>(item <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="at">addItem</span>(item)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" title="Array.prototype.forEach - MDN"><code>Array.prototype.forEach</code></a> is useful for conducting arbitrary operations. The argument (<code>item</code> in this case, but any name is allowed) is set to the value of each element in turn. In this case, we simply call the <code>addItem</code> method with each item in the list. So <code>addItem</code> is called four times, once for each value.</p>
<h2 id="clearing-the-list">Clearing the list</h2>
<p>We need a function to clear the entire list. We could do this by replacing the content of the list element with an empty string.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">function</span> <span class="at">clearList</span>() <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="va">listElement</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="op">}</span></span></code></pre></div>
<p>However, its more efficient to loop over the DOM and remove each element in turn.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">function</span> <span class="at">clearList</span>() <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="cf">while</span>(<span class="va">listElement</span>.<span class="at">firstChild</span>) <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="va">listElement</span>.<span class="at">removeChild</span>(<span class="va">listElement</span>.<span class="at">firstChild</span>)<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="op">}</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="op">}</span></span></code></pre></div>
<p>Using a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/while" title="while - MDN"><code>while</code> loop</a> we call <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/firstChild" title="Node.firstChild - MDN"><code>Node.firstChild</code></a> to identify the next element and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/removeChild" title="Node.removeChild - MDN"><code>Node.removeChild</code></a> to remove each element in turn.</p>
<p>Calling this function in the console now clears the list as expected.</p>
<p>Finally, tidy up the whole lot by wrapping the list generation code in a reusable function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">function</span> <span class="at">renderList</span>(list) <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="va">list</span>.<span class="at">forEach</span>(item <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="at">addItem</span>(item)<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="op">}</span></span></code></pre></div>
<p>We will use this later to load data from local storage.</p>
<p>In your javascript file you should now have one variable declaration (<code>listElement</code>) and three functions (<code>addItem()</code>, <code>clearList()</code> and <code>renderList()</code>).</p>
<h2 id="add-some-interaction">Add some interaction</h2>
<p>Now we have the tools to add items and clear the list, we need to build a simple user interface.</p>
<p>Above the list, add an input element with <code>id="newItem"</code> and placeholder “new item” and a button with <code>id="addBtn"</code> and “add” as the content.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">&lt;input</span><span class="ot"> placeholder=</span><span class="st">&quot;new item&quot;</span><span class="ot"> id=</span><span class="st">&quot;newItem&quot;</span><span class="kw">&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;addBtn&quot;</span><span class="kw">&gt;</span>add<span class="kw">&lt;/button&gt;</span></span></code></pre></div>
<p>Below the list, add a button with <code>id="clearBtn"</code> and “clear” as the content.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;clearBtn&quot;</span><span class="kw">&gt;</span>clear<span class="kw">&lt;/button&gt;</span></span></code></pre></div>
<p>Wrap the list and these new elements in a <code>main</code> element. Your <code>index.html</code> file should now look like this.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb10-1"><a href="#cb10-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="kw">&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="kw">&lt;title&gt;</span>Shopping list<span class="kw">&lt;/title&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;css/styles.css&quot;</span><span class="kw">&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="kw">&lt;/head&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="kw">&lt;header&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>    <span class="kw">&lt;h1&gt;</span>Shopping list<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>  <span class="kw">&lt;/header&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="kw">&lt;main&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="kw">&lt;input</span><span class="ot"> placeholder=</span><span class="st">&quot;new item&quot;</span><span class="ot"> id=</span><span class="st">&quot;newItem&quot;</span><span class="kw">&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>    <span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;addBtn&quot;</span><span class="kw">&gt;</span>add<span class="kw">&lt;/button&gt;</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="kw">&lt;ul</span><span class="ot"> id=</span><span class="st">&quot;shopping&quot;</span><span class="kw">&gt;&lt;/ul&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>    <span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;clearBtn&quot;</span><span class="kw">&gt;</span>clear<span class="kw">&lt;/button&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="kw">&lt;/main&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/shopping.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>We need to create JavaScript handles to our new elements. Add these new lines to the top of the file.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">const</span> newItem <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;newItem&#39;</span>)<span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">const</span> addBtn <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;addBtn&#39;</span>)<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">const</span> clearBtn <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;clearBtn&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Now we can add a simple event listener (using <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" title="AddEventListener - MDN"><code>addEventListener</code></a>) to our ‘add’ button to insert a new element into our list based on the input value.</p>
<p>Our first version of the event listener can be added at the bottom of the file.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1"></a><span class="va">addBtn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="at">addItem</span>(<span class="va">newItem</span>.<span class="at">value</span>)<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Type some text into the input and click the add button. This works pretty well but it has some problems.</p>
<ul>
<li>What happens when the input is blank?</li>
<li>What happens when we click the add button more than once?</li>
</ul>
<p>We need to add a few lines of code to smooth out this interaction.</p>
<p>First, we check that the input has some text and only add the item if it does.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1"></a><span class="va">addBtn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="cf">if</span>(<span class="va">newItem</span>.<span class="at">value</span>) <span class="op">{</span> <span class="co">//&lt;- this</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="at">addItem</span>(<span class="va">newItem</span>.<span class="at">value</span>)<span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="op">}</span> <span class="co">//&lt;- and this</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Try it. No more blank entries in our list. Great. But we still add the same value multiple times when we click the button more than once.</p>
<p>So we clear the input by setting its value to <code>null</code> each time an item is successfully added to the list.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1"></a><span class="va">addBtn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="cf">if</span>(<span class="va">newItem</span>.<span class="at">value</span>) <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="at">addItem</span>(<span class="va">newItem</span>.<span class="at">value</span>)<span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="va">newItem</span>.<span class="at">value</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span> <span class="co">//&lt;- this</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="op">}</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>To clear the whole list we add an event listener to the clear button.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1"></a><span class="va">clearBtn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="at">clearList</span>()<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Try it. We now have a very basic working list.</p>
<h2 id="removing-individual-items">Removing individual items</h2>
<p>The list is becoming useful but what if we make a mistake and want to remove an item from the list without starting from scratch?</p>
<p>We need a way to select an individual item for removal. For this, we need a button on each item. So we need to modify our <code>addItem</code> function.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">function</span> <span class="at">addItem</span>(item) <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="kw">const</span> itemElement <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;li&#39;</span>)<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="va">itemElement</span>.<span class="at">textContent</span> <span class="op">=</span> item<span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="kw">const</span> deleteButton <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;button&#39;</span>)<span class="op">;</span> <span class="co">// &lt;- new</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="va">deleteButton</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;x&#39;</span><span class="op">;</span>                        <span class="co">// &lt;- new</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="va">itemElement</span>.<span class="at">appendChild</span>(deleteButton)<span class="op">;</span>                 <span class="co">// &lt;- new</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="va">listElement</span>.<span class="at">appendChild</span>(itemElement)<span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="op">};</span></span></code></pre></div>
<p>We have created a new button for each element and appended it to the list item. When we add new items, they now also contain a button which we will use to delete the individual list item.</p>
<p>We need the new button to delete the entire <code>li</code> element. For this we use a closure. We add an event listener to each button which removes the parent element from the list.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">function</span> <span class="at">addItem</span>(item) <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="kw">const</span> itemElement <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;li&#39;</span>)<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="va">itemElement</span>.<span class="at">textContent</span> <span class="op">=</span> item<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="kw">const</span> deleteButton <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;button&#39;</span>)<span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="va">deleteButton</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;x&#39;</span><span class="op">;</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="va">itemElement</span>.<span class="at">appendChild</span>(deleteButton)<span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="va">deleteButton</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span> <span class="co">// &lt;- new</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>    <span class="va">listElement</span>.<span class="at">removeChild</span>(itemElement)<span class="op">;</span>        <span class="co">// &lt;- new</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="op">}</span>)<span class="op">;</span>                                            <span class="co">// &lt;- new</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="va">listElement</span>.<span class="at">appendChild</span>(itemElement)<span class="op">;</span></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="op">};</span></span></code></pre></div>
<p>The closure means that the event listener will always have a reference to <code>itemElement</code>. Even after the <code>addItem</code> function has completed, the scope it created, including the <code>const itemElement</code> is available to the <code>deleteButton</code> event listener.</p>
<h2 id="tidy-up-the-look-and-feel">Tidy up the look and feel</h2>
<p>At this point you may want to add some styles. Begin with something like this.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb18-1"><a href="#cb18-1"></a>body {</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="kw">max-width</span>: <span class="dv">500</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="kw">margin</span>: <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>}</span>
<span id="cb18-5"><a href="#cb18-5"></a>ul {</span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="kw">padding</span>: <span class="dv">1</span><span class="dt">em</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="kw">margin</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>}</span>
<span id="cb18-9"><a href="#cb18-9"></a>li {</span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="kw">display</span>: flex<span class="op">;</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="kw">justify-content</span>: space-between<span class="op">;</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>}</span></code></pre></div>
<p>We position the body in the center of the page, overwrite the default <code>ul</code> padding and margin and justify the <code>&lt;li&gt;</code> element content using <code>display: flex</code> and <code>justify-content: space-between</code>. This will put the text on the left and the button on the right.</p>
<p>Add a few more styles if you like.</p>
<h2 id="saving-the-list">Saving the list</h2>
<p>We now have a fairly functional shopping list app. The only problem is that if we close the page or reload it the list data is lost and we begin with a blank list each time.</p>
<p>We will load the list from <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" title="local storage - MDN">local storage</a> on opening the page and save the list back to local storage on closing the page.</p>
<p>First, we need to save the list to local storage. We do this in an event listener we add to the window event handler <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload" title="beforeunload event - MDN"><code>onbeforeunload</code></a> event. This even will fire when the window is about to unload its resources in preparation to close the page.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1"></a><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;beforeunload&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="kw">const</span> items <span class="op">=</span> [...<span class="va">listElement</span>.<span class="at">childNodes</span>]<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="cf">if</span>(<span class="va">items</span>.<span class="at">length</span>) <span class="op">{</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="kw">const</span> list <span class="op">=</span> <span class="va">items</span>.<span class="at">map</span>(item <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>      <span class="cf">return</span> <span class="va">item</span>.<span class="va">textContent</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">-1</span>)<span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>    <span class="va">localStorage</span>.<span class="at">setItem</span>(<span class="st">&#39;shopping-list&#39;</span><span class="op">,</span> list)<span class="op">;</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>    <span class="va">localStorage</span>.<span class="at">removeItem</span>(<span class="st">&#39;shopping-list&#39;</span>)<span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="op">}</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Here we are extracting our item data from the DOM.</p>
<p>First, we convert the list child nodes to an array using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" title="spread syntax - MDN">spread operator</a>. Then we check the length of the array. If the array is empty then we delete our local storage record.</p>
<p>If the list contains data then we extract the item text into an array using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" title="Array.prototype.map - MDN">Array.prototype.map</a> function. We call <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent" title="node.textContent - MDN">Node.textContent</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/slice" title="String.prototype.slice - MDN">String.prototype.slice</a> on each list element within the callback.</p>
<p>Our item text is contained within each list item element along with a delete button. Note that <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent" title="node.textContent - MDN">Node.textContent</a> returns the concatenation of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent" title="node.textContent - MDN">textContent</a> of every child node. So we get an extra ‘x’ from the delete button concatenated to the end of our string. We remove this with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/slice" title="String.prototype.slice - MDN">String.prototype.slice</a>.</p>
<h2 id="loading-the-list">Loading the list</h2>
<p>With the list data from previous session stored in local storage we now just need to read these data back into the page when the page loads.</p>
<p>For this, we add an event listener to the window event handler <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/DOMContentLoaded_event" title="DOMContentLoaded event - MDN">DOMContentLoaded</a> event. This event fires once the DOM is completely loaded so we can be sure the list element will be available.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1"></a><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;DOMContentLoaded&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="kw">const</span> shoppingList <span class="op">=</span> <span class="va">localStorage</span>.<span class="at">getItem</span>(<span class="st">&#39;shopping-list&#39;</span>)<span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="cf">if</span>(shoppingList) <span class="op">{</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="at">renderList</span>(<span class="va">shoppingList</span>.<span class="at">split</span>(<span class="st">&#39;,&#39;</span>))<span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="op">}</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>We extract the data from local storage as a comma-separated string. To convert this to an array we use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split" title="String.prototype.split - MDN">String.prototype.split</a> method and pass the resultant array into our <code>renderList()</code> function.</p>
<p>Now the list will be remembered even if we close the page and open it again.</p>
<h2 id="upgrade-the-interface">Upgrade the interface</h2>
<p>The list is nice and all but if you want to write a long list then you have to flip between using the keyboard to type and using the mouse to click. This is annoying and inefficient.</p>
<p>The following code adds a handler for the input element <code>keyup</code> event. The <code>keyup</code> event fires when a key is released.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1"></a><span class="va">newItem</span>.<span class="at">addEventListener</span>(<span class="st">&quot;keyup&quot;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="cf">if</span> (<span class="va">ev</span>.<span class="at">keyCode</span> <span class="op">===</span> <span class="dv">13</span>) <span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>    <span class="va">addBtn</span>.<span class="at">click</span>()<span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="op">}</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>The handler is very simple. If the enter key (keyCode 13) is being released then we call <code>addBtn.click()</code> to trigger the previously defined event handler for adding an item.</p>
<p>So now it is possible to add multiple items to the list without leaving the keyboard.</p>
<p>Another potential improvement is to allow comma-separated values to be entered into the input and separated out into items on the list.</p>
<p>To do this we can adjust the <code>addBtn</code> event listener.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1"></a><span class="va">addBtn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> ev <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="va">newItem</span>.<span class="va">value</span>.<span class="at">split</span>(<span class="st">&#39;,&#39;</span>).<span class="at">forEach</span>(v <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>    <span class="cf">if</span>(v) <span class="op">{</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>      <span class="at">addItem</span>(v)<span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="op">}</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="va">newItem</span>.<span class="at">value</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Now the input value is split into an array of strings and each string is added to the list individually (but only if it contains text). Try this by entering multiple items separated by commas.</p>
<h2 id="tidy-up">Tidy up</h2>
<p>Now we have a working system we will protect all our code inside a self-executing anonymous function.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1"></a>(() <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="co">// all existing code goes here</span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="op">}</span>)()</span></code></pre></div>
<p>This keeps all our variables cleanly outside of the global scope.</p>
<hr />
<h1 id="challenges">Challenges</h1>
<p>The shopping list app is now fairly functional. However, there are a few scenarios where it could be frustrating to work with and a few possible improvements.</p>
<h2 id="multiple-tabs">Multiple tabs</h2>
<p>Think about what happens when the app is opened in two tabs simultaneously.</p>
<p>Try this:</p>
<ol type="1">
<li><p>Open the shopping list in a browser tab and add a few items</p></li>
<li><p>Open the shopping list in another tab, add a few more items and close the list.</p></li>
<li><p>Close the original tab.</p></li>
<li><p>Open the shopping list again.</p></li>
</ol>
<p>What happened to your latest additions?</p>
<p>Try to implement an improvement to avoid this problem.</p>
<p>potential solutions: - allow a manual load/save option? - warn the user before editing the local storage? - work with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/storage_event" title="storage event - MDN"><code>storage</code></a> event?</p>
<h2 id="multiple-lists">Multiple lists</h2>
<p>If you have got this far then well done. This one is for experts only as it requires some fairly serious adaptations to the code. Though perhaps not as much as you might think.</p>
<p>Our list data are stored under the ‘shopping-list’ key in local storage.</p>
<p>Think about how you might allow for multiple shopping lists to be stored and managed.</p>
<p>What user interface changes would be required?</p>
<p>Try refactoring the code to allow the user to create and manage multiple named lists.</p>
</body>
</html>
